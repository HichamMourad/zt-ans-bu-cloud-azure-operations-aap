= Lab Guide: Deploying Applications on Azure VMs
:toc:
:toc-title: Table of Contents
:sectnums:
:icons: font

_A guide to deploying applications to virtual machines in Microsoft Azure using the Ansible Automation Platform._

*Estimated time to complete: 15 minutes*

---

== Lab Overview

In this final challenge, you will create and run a job template to deploy an application to a Linux virtual machine on Azure. You will then verify the installation using an ad-hoc command.

---

== Task 1: Create the "Deploy Application" Job Template

First, you will create a job template with a survey that allows a user to select which application to install and where.

. **Navigate to the Automation Controller UI.**
+
Click on the **Automation Controller** tab at the top of your lab window.

. **Log in with the provided credentials.**
+
[cols="1,2a"]
|===
| Parameter | Value
| Username | `admin`
| Password | `ansible123!`
|===

. **Navigate to the Templates page.**
+
In the left navigation menu, go to **Resources** â†’ **Templates**.

. **Initiate the creation of a new job template.**
+
Click the blue **Add** button, then select **Add job template**.
+
image::../assets/add_job_template.png[Add a new job template, opts="border"]

. **Enter the job template details.**
+
Fill out the form with the following information:
+
[cols="1,1"]
|===
| Parameter | Value
| Name | `Deploy Application`
| Job Type | `Run`
| Inventory | `Azure Inventory`
| Project | `Product Demos Project`
| Execution Environment | `Default execution environment`
| Playbook | `linux/deploy_application.yml`
| Credentials | `RHEL on Azure`
|===

. **Save the job template.**
+
Scroll to the bottom and click the blue **Save** button.
+
image::../assets/save-cancel.png[Save a new job template, opts="border"]

. **Add the first survey question.**
+
Navigate to the **Survey** tab and click the blue **Add** button.
+
image::../assets/survey.png[Survey tab for a job template, opts="border"]
+
Configure the first question as follows:
+
[cols="1,1"]
|===
| Parameter | Value
| Question | `Enter the Linux Host you want to patch`
| Answer variable name | `_hosts`
| Answer type | `Text`
| Default answer | `RHEL-ansible`
|===
+
Click **Save**.

. **Add the second survey question.**
+
On the survey page, click **Add** again. Configure the second question as follows:
+
[cols="1,1"]
|===
| Parameter | Value
| Question | `Which application do you want to install?`
| Answer variable name | `application`
| Answer type | `Multiple Choice (single select)`
| Multiple Choice Options | `nginx`, `gdb`, `httpd`, `nano`
|===
+
NOTE: After entering the options, select the radio button next to `nginx` to make it the default choice. Click **Save**.

. **Enable the survey.**
+
You must **enable the survey** by clicking the toggle switch at the top of the survey page. The text will change from `SURVEY OFF` to `SURVEY ON`.
+
image::../assets/survey_enabled.png[Enable survey toggle, opts="border"]

---

== Task 2: Run the Job Template

Now you will launch the template and use the survey to deploy an application.

. **Navigate to the Templates page.**
+
Go to **Resources** â†’ **Templates**.

. **Launch the "Deploy Application" job template.**
+
Find the `Deploy Application` template and click the **Launch** icon (ðŸš€).

. **Complete the survey and run the job.**
+
You will be prompted with the survey. The default values are correct (`RHEL-ansible` for the host and `nginx` for the application). Click **Next**, then click **Launch** to run the job.

. **Monitor the job progress.**
+
The job will take a few moments to complete. The output will confirm that `nginx` was installed on the `RHEL-ansible` host.

---

== Task 3: Verify Installation with an Ad-Hoc Command

Finally, you will run an ad-hoc command to confirm that the `nginx` service was installed and is running.

. **Navigate to your inventory hosts.**
+
In the left navigation menu, go to **Resources** â†’ **Inventories**, click on `Azure Inventory`, and then select the **Hosts** tab.

. **Select the host and initiate the command.**
+
Select the checkbox next to `RHEL-ansible`, then click the **Run command** button.

. **Configure the ad-hoc command.**
+
A wizard will appear. Fill it out as follows:
+
--
a. *Details View:* From the *Module* dropdown, select `service`. In the *Arguments* field, enter `name=nginx`. Click **Next**.
b. *Execution Environment View:* Select `Default execution environment`. Click **Next**.
c. *Credential View:* Select `RHEL on Azure`. Click **Next**.
--

. **Launch the ad-hoc command.**
+
On the *Preview* screen, click **Launch**.

. **Observe the output.**
+
The job will complete in a few moments. The output will show details about the `nginx` service on the host, confirming its status.

---

== Conclusion

Thank you for taking the time to learn about automating cloud operations tasks in Azure using the Red Hat Ansible Automation Platform!

In this lab, you have seen how automation can be used to deploy applications and how ad-hoc commands can perform quick checks on target hosts. These same principles can be easily applied to other cloud environments.

== Troubleshooting

If you have encountered an issue or have noticed something not quite right, please open an issue with the lab maintainers.
